<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  </head>
  <body>
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; maxTrack: 2"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <a-asset-item id="WhaleO3" src="./WhaleO1.glb"></a-asset-item>
        <a-asset-item id="OctopusO3" src="./Octopus.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Ballena -->
      <a-entity id="target-whale" mindar-image-target="targetIndex: 0">
        <a-gltf-model
          src="#WhaleO3"
          position="0 0 0"
          scale="0.7 0.7 0.7"
        ></a-gltf-model>

        <!-- Menú interactivo -->
        <a-entity id="whale-menu" visible="false" position="0 0.8 0">
          <a-plane color="#007BFF" width="1.5" height="0.5" opacity="0.8"></a-plane>
          <a-text id="whale-text" value="Dato curioso 1: Las ballenas son los animales más grandes del planeta."
                  align="center" color="#FFF" width="1.4" position="0 0 0.01"></a-text>
          <a-box id="whale-prev" color="blue" depth="0.05" height="0.2" width="0.3" position="-0.7 -0.3 0.01"></a-box>
          <a-box id="whale-next" color="blue" depth="0.05" height="0.2" width="0.3" position="0.7 -0.3 0.01"></a-box>
        </a-entity>
      </a-entity>

      <!-- Pulpo -->
      <a-entity id="target-octopus" mindar-image-target="targetIndex: 1">
        <a-gltf-model
          src="#OctopusO3"
          position="0 -0.25 0"
          scale="0.05 0.05 0.05"
        ></a-gltf-model>

        <!-- Menú interactivo -->
        <a-entity id="octopus-menu" visible="false" position="0 0.8 0">
          <a-plane color="#007BFF" width="1.5" height="0.5" opacity="0.8"></a-plane>
          <a-text id="octopus-text" value="Dato curioso 1: Los pulpos tienen tres corazones."
                  align="center" color="#FFF" width="1.4" position="0 0 0.01"></a-text>
          <a-box id="octopus-prev" color="blue" depth="0.05" height="0.2" width="0.3" position="-0.7 -0.3 0.01"></a-box>
          <a-box id="octopus-next" color="blue" depth="0.05" height="0.2" width="0.3" position="0.7 -0.3 0.01"></a-box>
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      const whaleFacts = [
        "Dato curioso 1: Las ballenas son los animales más grandes del planeta.",
        "Dato curioso 2: Las ballenas jorobadas pueden cantar canciones complejas.",
        "Dato curioso 3: El corazón de una ballena azul puede pesar más de 150 kg."
      ];

      const octopusFacts = [
        "Dato curioso 1: Los pulpos tienen tres corazones.",
        "Dato curioso 2: Los pulpos pueden cambiar de color y textura para camuflarse.",
        "Dato curioso 3: Son considerados los invertebrados más inteligentes."
      ];

      let whaleIndex = 0;
      let octopusIndex = 0;
      let whaleDetected = false;
      let octopusDetected = false;

      const whaleMenu = document.getElementById("whale-menu");
      const octopusMenu = document.getElementById("octopus-menu");

      const whaleText = document.getElementById("whale-text");
      const octopusText = document.getElementById("octopus-text");

      // --- Función para actualizar visibilidad de menús ---
      function updateMenus() {
        if (whaleDetected && !octopusDetected) {
          whaleMenu.setAttribute("visible", true);
          octopusMenu.setAttribute("visible", false);
        } else if (!whaleDetected && octopusDetected) {
          whaleMenu.setAttribute("visible", false);
          octopusMenu.setAttribute("visible", true);
        } else {
          // si ambos detectados o ninguno
          whaleMenu.setAttribute("visible", false);
          octopusMenu.setAttribute("visible", false);
        }
      }

      // --- Eventos de detección ---
      const whaleTarget = document.getElementById("target-whale");
      const octopusTarget = document.getElementById("target-octopus");

      whaleTarget.addEventListener("targetFound", () => {
        whaleDetected = true;
        whaleIndex = 0;
        whaleText.setAttribute("value", whaleFacts[whaleIndex]);
        updateMenus();
      });

      whaleTarget.addEventListener("targetLost", () => {
        whaleDetected = false;
        updateMenus();
      });

      octopusTarget.addEventListener("targetFound", () => {
        octopusDetected = true;
        octopusIndex = 0;
        octopusText.setAttribute("value", octopusFacts[octopusIndex]);
        updateMenus();
      });

      octopusTarget.addEventListener("targetLost", () => {
        octopusDetected = false;
        updateMenus();
      });

      // --- Botones interactivos ---
      const addClick = (entity, callback) => {
        entity.addEventListener("click", callback);
        // Para interacción con toque en dispositivos móviles
        entity.addEventListener("touchstart", callback);
      };

      // Ballena
      addClick(document.getElementById("whale-prev"), () => {
        whaleIndex = (whaleIndex - 1 + whaleFacts.length) % whaleFacts.length;
        whaleText.setAttribute("value", whaleFacts[whaleIndex]);
      });
      addClick(document.getElementById("whale-next"), () => {
        whaleIndex = (whaleIndex + 1) % whaleFacts.length;
        whaleText.setAttribute("value", whaleFacts[whaleIndex]);
      });

      // Pulpo
      addClick(document.getElementById("octopus-prev"), () => {
        octopusIndex = (octopusIndex - 1 + octopusFacts.length) % octopusFacts.length;
        octopusText.setAttribute("value", octopusFacts[octopusIndex]);
      });
      addClick(document.getElementById("octopus-next"), () => {
        octopusIndex = (octopusIndex + 1) % octopusFacts.length;
        octopusText.setAttribute("value", octopusFacts[octopusIndex]);
      });
    </script>
  </body>
</html>

