<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      #menu, #model-buttons {
        position: fixed;
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 10px 20px;
        border-radius: 15px;
        color: white;
        font-family: sans-serif;
        z-index: 999;
        text-align: center;
        width: 90%;
        max-width: 450px;
        display: none;
      }

      #menu button, #model-buttons button {
        margin: 5px;
        padding: 8px 15px;
        border: none;
        border-radius: 10px;
        background: #1e90ff;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }

      #menu button:hover, #model-buttons button:hover {
        background: #4682b4;
      }

      #fact-box { margin-top: 10px; font-size: 14px; }

      #scan-message {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.75);
        padding: 12px 18px;
        border-radius: 12px;
        color: white;
        font-family: sans-serif;
        z-index: 1000;
        text-align: center;
      }

      #scan-message img {
        display: block;
        margin: 10px auto 0 auto;
        max-width: 150px;
        border-radius: 8px;
      }

      /* Botones de control */
      #controls {
        position: fixed;
        bottom: 140px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }

      #controls button {
        padding: 6px 12px;
        border: none;
        border-radius: 8px;
        background: #444;
        color: white;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <!-- MENSAJE ESCANEAR -->
    <div id="scan-message">
      Apunta tu c√°mara hacia las im√°genes para comenzar
      <img id="scan-image" src="./target1.png" alt="Target a escanear">
    </div>

    <!-- Men√∫ flotante -->
    <div id="menu">
      <div id="fact-box">Selecciona un animal para ver curiosidades</div>
      <div>
        <button id="btnPrev">‚¨ÖÔ∏è Anterior</button>
        <button id="btnNext">‚û°Ô∏è Siguiente</button>
      </div>
    </div>

    <!-- Botones cambio de modelos -->
    <div id="model-buttons"></div>

    <!-- Controles AR -->
    <div id="controls">
      <button id="btnStart">‚ñ∂Ô∏è Start</button>
      <button id="btnPause">‚è∏ Pause</button>
      <button id="btnPauseVideo">‚è∏ Pause (keep video)</button>
      <button id="btnUnPause">üîÑ UnPause</button>
      <button id="btnStop">‚èπ Stop</button>
    </div>

    <!-- Escena AR -->
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; maxTrack: 2"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <!-- Modelos ballena -->
        <a-asset-item id="WhaleModel1" src="./WhaleO1.glb"></a-asset-item>
        <a-asset-item id="WhaleModel2" src="./WhaleO2.glb"></a-asset-item>
        <!-- Modelos pulpo -->
        <a-asset-item id="OctopusModel1" src="./Octopus.glb"></a-asset-item>
        <a-asset-item id="OctopusModel2" src="./Octopus2.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Ballena -->
      <a-entity id="target-whale" mindar-image-target="targetIndex: 0">
        <a-gltf-model id="whale-model"
          src="#WhaleModel1"
          position="0 0 0"
          scale="0.7 0.7 0.7"
          rotation="0 0 0"
          visible="true"
          animation__updown="property: position; to: 0 0.3 0; dur: 2000; easing: easeInOutSine; loop: true; dir: alternate"
          animation__spin="property: rotation; to: 0 360 0; dur: 6000; loop: true; easing: linear">
        </a-gltf-model>
      </a-entity>

      <!-- Pulpo -->
      <a-entity id="target-octopus" mindar-image-target="targetIndex: 1">
        <a-gltf-model id="octopus-model"
          src="#OctopusModel1"
          position="0 -0.25 0"
          scale="0.05 0.05 0.05"
          rotation="0 0 0"
          visible="true"
          animation__updown="property: position; to: 0 0.2 0; dur: 2500; easing: easeInOutSine; loop: true; dir: alternate"
          animation__spin="property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear">
        </a-gltf-model>
      </a-entity>
    </a-scene>

    <script>
      const factBox = document.querySelector("#fact-box");
      const menu = document.querySelector("#menu");
      const scanMessage = document.querySelector("#scan-message");
      const modelButtons = document.querySelector("#model-buttons");

      const facts = {
        whale: [
          "Las ballenas azules son los animales m√°s grandes que han existido.",
          "Su coraz√≥n puede pesar lo mismo que un coche peque√±o.",
          "Se comunican con cantos que viajan grandes distancias bajo el agua."
        ],
        octopus: [
          "Los pulpos tienen tres corazones y sangre azul.",
          "Pueden cambiar de color y textura para camuflarse.",
          "Son considerados de los invertebrados m√°s inteligentes."
        ]
      };

      let currentAnimal = null;
      let factIndex = 0;
      let whaleDetected = false;
      let octopusDetected = false;

      function showFact() {
        if (currentAnimal) {
          factBox.innerText = facts[currentAnimal][factIndex];
        }
      }

      function updateUI() {
        if (whaleDetected || octopusDetected) {
          menu.style.display = "block";
          scanMessage.style.display = "none";
          modelButtons.style.display = "block";
          modelButtons.innerHTML = "";

          if (whaleDetected) {
            modelButtons.innerHTML = `
              <button onclick="changeModel('whale', 1)">üêã Modelo 1</button>
              <button onclick="changeModel('whale', 2)">üêã Modelo 2</button>`;
          } else if (octopusDetected) {
            modelButtons.innerHTML = `
              <button onclick="changeModel('octopus', 1)">üêô Modelo 1</button>
              <button onclick="changeModel('octopus', 2)">üêô Modelo 2</button>`;
          }
        } else {
          menu.style.display = "none";
          modelButtons.style.display = "none";
          scanMessage.style.display = "block";
        }
      }

      // Cambiar modelo
      window.changeModel = function(animal, modelNumber) {
        if (animal === "whale") {
          document.querySelector("#whale-model").setAttribute("src", modelNumber === 1 ? "#WhaleModel1" : "#WhaleModel2");
        } else if (animal === "octopus") {
          document.querySelector("#octopus-model").setAttribute("src", modelNumber === 1 ? "#OctopusModel1" : "#OctopusModel2");
        }
      };

      // Eventos detecci√≥n
      document.getElementById("target-whale").addEventListener("targetFound", () => {
        whaleDetected = true;
        currentAnimal = "whale";
        factIndex = 0;
        showFact();
        updateUI();
      });
      document.getElementById("target-whale").addEventListener("targetLost", () => {
        whaleDetected = false;
        updateUI();
      });

      document.getElementById("target-octopus").addEventListener("targetFound", () => {
        octopusDetected = true;
        currentAnimal = "octopus";
        factIndex = 0;
        showFact();
        updateUI();
      });
      document.getElementById("target-octopus").addEventListener("targetLost", () => {
        octopusDetected = false;
        updateUI();
      });

      // Botones curiosidades
      document.querySelector("#btnNext").addEventListener("click", () => {
        if (currentAnimal) {
          factIndex = (factIndex + 1) % facts[currentAnimal].length;
          showFact();
        }
      });
      document.querySelector("#btnPrev").addEventListener("click", () => {
        if (currentAnimal) {
          factIndex = (factIndex - 1 + facts[currentAnimal].length) % facts[currentAnimal].length;
          showFact();
        }
      });

      // Rotaci√≥n de im√°genes del mensaje
      const scanImage = document.querySelector("#scan-image");
      const scanImages = ["./Ballena3.png", "./OctupusO3.png"];
      let scanIndex = 0;
      setInterval(() => {
        scanIndex = (scanIndex + 1) % scanImages.length;
        scanImage.src = scanImages[scanIndex];
      }, 2000);

      // Eventos globales
      const sceneEl = document.querySelector("a-scene");
      let arSystem;
      sceneEl.addEventListener("loaded", () => { arSystem = sceneEl.systems["mindar-image-system"]; });
      sceneEl.addEventListener("arReady", () => { console.log("AR listo ‚úÖ"); });
      sceneEl.addEventListener("arError", (err) => { console.error("Error AR ‚ùå", err); });

      // Controles Start / Pause / Stop
      document.querySelector("#btnStart").addEventListener("click", () => { arSystem.start(); });
      document.querySelector("#btnPause").addEventListener("click", () => { arSystem.pause(false); });
      document.querySelector("#btnPauseVideo").addEventListener("click", () => { arSystem.pause(true); });
      document.querySelector("#btnUnPause").addEventListener("click", () => { arSystem.unpause(); });
      document.querySelector("#btnStop").addEventListener("click", () => { arSystem.stop(); });
    </script>
  </body>
</html>



