<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      #menu {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 10px 20px;
        border-radius: 15px;
        color: white;
        font-family: sans-serif;
        z-index: 999;
        text-align: center;
        width: 80%;
        max-width: 400px;
      }

      #menu button {
        margin: 5px;
        padding: 8px 15px;
        border: none;
        border-radius: 10px;
        background: #1e90ff;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }

      #menu button:hover {
        background: #4682b4;
      }

      #fact-box {
        margin-top: 10px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <!-- Menú flotante -->
    <div id="menu">
      <div>
        <button id="btnPrev">⬅️ Anterior</button>
        <button id="btnNext">➡️ Siguiente</button>
      </div>
    </div>

    <!-- Escena AR -->
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; maxTrack: 2"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <a-asset-item id="WhaleModel" src="./WhaleO1.glb"></a-asset-item>
        <a-asset-item id="OctopusModel" src="./Octopus.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Ballena -->
      <a-entity id="target-whale" mindar-image-target="targetIndex: 0">
        <a-gltf-model
          id="whale-model"
          src="#WhaleModel"
          position="0 0 0"
          scale="0.7 0.7 0.7"
          rotation="0 0 0"
          animation__updown="property: position; to: 0 0.3 0; dur: 2000; easing: easeInOutSine; loop: true; dir: alternate"
          animation__spin="property: rotation; to: 0 360 0; dur: 6000; loop: true; easing: linear"
        ></a-gltf-model>
      </a-entity>

      <!-- Pulpo -->
      <a-entity id="target-octopus" mindar-image-target="targetIndex: 1">
        <a-gltf-model
          id="octopus-model"
          src="#OctopusModel"
          position="0 -0.25 0"
          scale="0.05 0.05 0.05"
          rotation="0 0 0"
          animation__updown="property: position; to: 0 0.2 0; dur: 2500; easing: easeInOutSine; loop: true; dir: alternate"
          animation__spin="property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear"
        ></a-gltf-model>
      </a-entity>
    </a-scene>

    <script>
      const factBox = document.querySelector("#fact-box");

      const facts = {
        whale: [
          "Las ballenas azules son los animales más grandes que han existido.",
          "Su corazón puede pesar lo mismo que un coche pequeño.",
          "Se comunican con cantos que viajan grandes distancias bajo el agua."
        ],
        octopus: [
          "Los pulpos tienen tres corazones y sangre azul.",
          "Pueden cambiar de color y textura para camuflarse.",
          "Son considerados de los invertebrados más inteligentes."
        ]
      };

      let currentAnimal = null;
      let factIndex = 0;

      // Flags de detección
      let whaleDetected = false;
      let octopusDetected = false;

      const whaleModel = document.getElementById("whale-model");
      const octopusModel = document.getElementById("octopus-model");

      const menu = document.getElementById("menu");

      function showFact() {
        factBox.innerText = facts[currentAnimal][factIndex];
      }

      function updateMenuVisibility() {
        // Mostrar menú solo si exactamente un target está detectado
        if ((whaleDetected && !octopusDetected) || (!whaleDetected && octopusDetected)) {
          menu.style.display = "block";
        } else {
          menu.style.display = "none";
        }
      }

      // --- Eventos de detección ---
      document.getElementById("target-whale").addEventListener("targetFound", () => {
        whaleDetected = true;
        currentAnimal = "whale";
        factIndex = 0;
        showFact();
        updateMenuVisibility();
      });
      document.getElementById("target-whale").addEventListener("targetLost", () => {
        whaleDetected = false;
        updateMenuVisibility();
      });

      document.getElementById("target-octopus").addEventListener("targetFound", () => {
        octopusDetected = true;
        currentAnimal = "octopus";
        factIndex = 0;
        showFact();
        updateMenuVisibility();
      });
      document.getElementById("target-octopus").addEventListener("targetLost", () => {
        octopusDetected = false;
        updateMenuVisibility();
      });

      // --- Botones para cambiar animal ---
      document.querySelector("#btnWhale").addEventListener("click", () => {
        whaleModel.setAttribute("visible", true);
        octopusModel.setAttribute("visible", false);
        currentAnimal = "whale";
        factIndex = 0;
        showFact();
      });

      document.querySelector("#btnOctopus").addEventListener("click", () => {
        whaleModel.setAttribute("visible", false);
        octopusModel.setAttribute("visible", true);
        currentAnimal = "octopus";
        factIndex = 0;
        showFact();
      });

      // --- Botones para navegar curiosidades ---
      document.querySelector("#btnNext").addEventListener("click", () => {
        factIndex = (factIndex + 1) % facts[currentAnimal].length;
        showFact();
      });

      document.querySelector("#btnPrev").addEventListener("click", () => {
        factIndex = (factIndex - 1 + facts[currentAnimal].length) % facts[currentAnimal].length;
        showFact();
      });
    </script>
  </body>
</html>

